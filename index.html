<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>새해 덕담 캠페인</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #fff;
    }
    .wrap { max-width: 860px; margin: 0 auto; }
    h1 { font-size: 30px; margin-bottom: 8px; }
    h2 { font-size: 20px; margin-top: 24px; }
    p { line-height: 1.6; margin: 6px 0; }
    .small { font-size: 13px; color: #666; }

    .card {
      border: 1px solid #ddd;
      border-radius: 14px;
      padding: 18px;
      margin-top: 20px;
    }

    .gifbox { display: flex; justify-content: center; margin-bottom: 12px; }
    .gifbox img {
      max-width: 420px;
      width: 100%;
      border: 1px solid #bbb;
      border-radius: 12px;
    }

    .btnrow {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 18px;
      border: 1px solid #111;
      background: #fff;
      border-radius: 14px;
      font-weight: 700;
      cursor: pointer;
    }
    button:disabled { opacity: 0.4; cursor: not-allowed; }

    .resultbox { text-align: center; margin-top: 10px; }
    .resultlabel {
      display: inline-block;
      border: 1px solid #111;
      padding: 12px 20px;
      border-radius: 14px;
      min-width: 220px;
    }
    .resultlabel .top { font-size: 14px; color: #555; }
    .resultlabel .val { font-size: 26px; font-weight: 900; margin-top: 6px; }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 16px;
    }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }

    label { display: block; font-weight: 700; margin-bottom: 6px; }
    input, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #111;
      border-radius: 12px;
      font-size: 16px;
      box-sizing: border-box;
    }
    textarea { min-height: 120px; resize: vertical; }

    .submitrow { display: flex; justify-content: center; margin-top: 16px; }
    .submitbtn { min-width: 240px; font-size: 18px; padding: 14px 20px; }

    .status { text-align: center; margin-top: 10px; color: #666; }
    .bad { color: #c33; font-weight: 700; }

    .final { text-align: center; font-size: 22px; font-weight: 900; padding: 30px 10px; }
  </style>
</head>

<body>
<div class="wrap">

  <h1>소개말</h1>
  <p>새해를 맞아 모두에게 전하는 따뜻한 한마디를 남겨주세요.</p>

  <h2>참여방법</h2>
  <p>복주머니를 눌러 행운의 제시어를 뽑아보세요! 뽑은 제시어에 맞춰 새해 덕담을 남겨주시면 참여가 완료됩니다.</p>
  <p class="small">
    본 이벤트는 참여자 확인 및 경품 지급을 위해 이름과 전화번호를 수집합니다.<br>
    수집된 개인정보는 이벤트 종료 후 즉시 파기됩니다.
  </p>
  <p class="small"><b>* 개인정보 수집·이용에 동의하신 경우에만 참여 가능합니다.</b></p>
<div style="margin:16px 0;">
  <div style="font-weight:900; margin-bottom:6px;">문의사항</div>
  <div style="font-size:15px; line-height:1.6; color:#333;">
    문의사항은 아래 연락처로 부탁드립니다.<br>
    기장군정신건강복지센터는 평일 09:00 ~ 18:00 운영하고 있습니다.<br>
    <span style="font-weight:900;">☎ 051-727-5386</span>
  </div>
</div>

  <!-- 메인 카드 -->
  <div id="mainCard" class="card">

    <div class="gifbox">
      <img id="gifImg" src="idle.png" alt="복주머니">
    </div>

    <div class="btnrow">
      <button id="pickBtn">쪽지 뽑기</button>
      <button id="repickBtn" disabled>다시 뽑기</button>
    </div>

    <!-- ✅ 분류박스: 뽑기 전엔 숨김, after.png 될 때 나타남 -->
    <div class="resultbox" id="resultBox">
      <div class="resultlabel">
        <div class="top">뽑기 분류</div>
        <div id="categoryText" class="val">-</div>
      </div>
    </div>

    <div class="grid">
      <div>
        <label>이름</label>
        <input id="name" placeholder="이름을 입력하세요">
      </div>
      <div>
        <label>전화번호(숫자만)</label>
        <input id="phone" placeholder="01012345678" inputmode="numeric">
      </div>
    </div>

    <div style="margin-top:12px;">
      <label>덕담 내용을 입력하세요</label>
      <textarea id="message" placeholder="쪽지를 뽑은 뒤 입력 가능합니다." disabled></textarea>
    </div>

    <div class="submitrow">
      <button id="submitBtn" class="submitbtn" disabled>제출</button>
    </div>

    <div id="status" class="status"></div>
  </div>

  <!-- 제출 후 -->
  <div id="finalCard" class="card" style="display:none;">
    <div class="final">감사합니다. 새해 복 많이 받으세요!</div>
  </div>

<!-- 센터 로고 -->
  <img
    src="center_logo.png"
    alt="센터 로고"
    style="
      max-width: 180px;
      width: 60%;
      height: auto;
      opacity: 0.9;
    "
  />
</div>

<script>
/* ================= 설정 ================= */

// ✅ Apps Script 웹앱 URL (형님 주소)
const WEB_APP_URL =
  "https://script.google.com/macros/s/AKfycbzYqm6S_aEvslvkmnCsEcaS1BASjb_YPB-i-t3Pvu6-UOFHSiPj_goeaxTOjWin0tOf/exec";

// 이미지 파일
const IMG_IDLE  = "idle.png";
const IMG_THROW = "throw.gif";
const IMG_AFTER = "after.png";

// 뽑기 항목
const CATEGORIES = ["사랑", "건강", "가족", "목표(꿈)", "행복"];

/* ================= 요소 ================= */

const gifImg = document.getElementById("gifImg");
const pickBtn = document.getElementById("pickBtn");
const repickBtn = document.getElementById("repickBtn");
const submitBtn = document.getElementById("submitBtn");

const resultBox = document.getElementById("resultBox");
const categoryText = document.getElementById("categoryText");

const nameEl = document.getElementById("name");
const phoneEl = document.getElementById("phone");
const msgEl = document.getElementById("message");
const statusEl = document.getElementById("status");

const mainCard = document.getElementById("mainCard");
const finalCard = document.getElementById("finalCard");

let currentCategory = "";

/* ================= 함수 ================= */

function normalizePhone(v) {
  return (v || "").replace(/[^0-9]/g, "");
}

function updateButtons() {
  const hasCategory = currentCategory !== "";
  repickBtn.disabled = !hasCategory;
  msgEl.disabled = !hasCategory;

  const ok =
    hasCategory &&
    nameEl.value.trim() &&
    normalizePhone(phoneEl.value).length >= 9 &&
    msgEl.value.trim();

  submitBtn.disabled = !ok;
}

function pickCategory(isRepick) {
  // ✅ 뽑기 시작: 분류박스 숨기고 애니 재생
  resultBox.style.display = "none";
  gifImg.src = IMG_THROW;

  // 결과는 아직 확정/표시 안 함
  categoryText.textContent = "-";
  currentCategory = "";

  // 다시 뽑기면 덕담 리셋
  if (isRepick) msgEl.value = "";

  // 애니 재생 중 잠깐 잠그기
repickBtn.disabled = true;
msgEl.disabled = true;
submitBtn.disabled = true;

const ANIM_MS = 1200; // throw.gif 길이에 맞춰 조절

setTimeout(() => {
  // 애니 끝: 정지 이미지
  gifImg.src = IMG_AFTER;

  // 여기서 결과 확정
  const idx = Math.floor(Math.random() * CATEGORIES.length);
  currentCategory = CATEGORIES[idx];

  // ✅ 분류박스 나타나며 결과 표시
  categoryText.textContent = currentCategory;
  resultBox.style.display = "block";

  // ✅ 덕담 입력 활성화 (모바일 자동 스크롤 방지용 딜레이)
  setTimeout(() => {
    msgEl.disabled = false;
    updateButtons();
  }, 300);

}, ANIM_MS);
}

async function submit() {
  submitBtn.disabled = true;
  statusEl.textContent = "제출 중입니다…";
  statusEl.classList.remove("bad");

  try {
    const body = new URLSearchParams({
      name: nameEl.value.trim(),
      phone: normalizePhone(phoneEl.value),
      category: currentCategory,
      message: msgEl.value.trim()
    });

    const res = await fetch(WEB_APP_URL, { method: "POST", body });
    const data = await res.json();

    if (!data.ok) throw new Error(data.error || "저장 실패");

    mainCard.style.display = "none";
    finalCard.style.display = "block";

  } catch (e) {
    statusEl.textContent = "제출 실패: " + (e.message || e);
    statusEl.classList.add("bad");
    submitBtn.disabled = false;
  }
}

/* ================= 이벤트 ================= */

pickBtn.onclick = () => pickCategory(false);
repickBtn.onclick = () => pickCategory(true);
submitBtn.onclick = submit;

[nameEl, phoneEl, msgEl].forEach(el => el.addEventListener("input", updateButtons));

phoneEl.addEventListener("input", () => {
  phoneEl.value = normalizePhone(phoneEl.value);
});

/* 초기 상태 */
gifImg.src = IMG_IDLE;
resultBox.style.display = "none"; // ✅ 처음엔 분류박스 숨김
updateButtons();
</script>

</body>
</html>





